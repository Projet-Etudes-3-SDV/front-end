<ion-content class="ion-padding min-h-full" [fullscreen]="true">
  <div [class]="isDesktop ? 'm-16' : ''" class="min-h-full">
    <div *ngIf="user && showAccountContent; else loading">
      <div [@listAnimation]>
        <div class="title-section w-full flex flex-col justify-center gap-2 px-6">
          <div class="w-full flex items-center gap-2 mt-4 rounded-lg">
            <ion-icon name="person-circle" class="color-theme-title text-3xl"></ion-icon>
            <h3 class="text-2xl font-bold text-black/80">Bienvenue sur votre compte</h3>
          </div>
          <hr class="w-full h-[2px] border-0 rounded-full my-[4px]" />
        </div>
        <ion-list class="m-[24px]">
          <ion-item>
            <ion-icon name="person-outline" slot="start"></ion-icon>
            <ion-label>Nom</ion-label>
            <p>{{ user.lastName }}</p>
          </ion-item>
          <ion-item>
            <ion-icon name="person" slot="start"></ion-icon>
            <ion-label>Prénom</ion-label>
            <p>{{ user.firstName }}</p>
          </ion-item>
          <ion-item>
            <ion-icon name="mail" slot="start"></ion-icon>
            <ion-label>Email</ion-label>
            <p>{{ user.email }}</p>
          </ion-item>
          <ion-item>
            <ion-icon name="calendar" slot="start"></ion-icon>
            <ion-label>Nombre d'abonnements actifs</ion-label>
            <p>{{ getActiveSubscriptionCount() }}</p>
          </ion-item>
        </ion-list>

        <div class="title-section w-full flex flex-col justify-center gap-2 px-6">
          <div class="w-full flex items-center gap-2 mt-4 rounded-lg">
            <ion-icon name="cash" class="color-theme-title text-3xl"></ion-icon>
            <h3 class="text-2xl font-bold text-black/80">Vos abonnements</h3>
          </div>
          <hr class="w-full h-[2px] border-0 rounded-full my-[4px]" />
        </div>
        <ion-list *ngIf="userSubscriptions.length > 0" class="m-[24px]">
          <ion-item *ngFor="let sub of userSubscriptions" lines="none">
            <ion-label class="flex flex-col gap-1">
          <h4 class="text-base font-semibold">{{ sub.product.name }}</h4>
          <span class="text-sm text-blue-400 italic">{{ sub.product.category.name }}</span>

          <div class="text-sm mt-1 text-gray-300">
            <p>
              {{ sub.plan === 'monthly' ? (sub.product.monthlyPrice | currency:'EUR') : (sub.product.yearlyPrice | currency:'EUR') }}
              /{{ sub.plan === 'monthly' ? 'mois' : 'an' }}
            </p>
            <p>
              Statut : <a [ngClass]="sub.status === 'active' ? 'text-green-500' : 'text-red-600'">{{ sub.status === 'active' ? 'Actif' : 'Annulé' }}</a>
            </p>
            <p>Début : {{ sub.startDate | date:'EEEE d MMMM y à HH:mm' }}</p>
            <p>Fin : {{ sub.endDate | date:'EEEE d MMMM y à HH:mm' }}</p>
            <p>Renouvellement automatique : {{ sub.autoRenew ? 'Oui' : 'Non' }}</p>
          </div>
            </ion-label>
            <ion-icon name="chevron-forward-outline" slot="end" class="text-blue-400 text-2xl"></ion-icon>
          </ion-item>
        </ion-list>

        <ion-list *ngIf="userSubscriptions.length === 0" class="m-[24px]">
          <ion-item>
            <ion-icon name="alert-circle" slot="start"></ion-icon>
            <ion-label>Aucun abonnement trouvé.</ion-label>
          </ion-item>
        </ion-list>

        <ion-button class="m-6 uppercase" expand="full" color="danger" (click)="logout()">
          <ion-icon name="log-out" class="mr-2"></ion-icon>
          Se Déconnecter
        </ion-button>
      </div>
    </div>

    <ng-template #loading>
      <ion-spinner name="crescent" class="ion-padding w-full flex items-center justify-center"></ion-spinner>
    </ng-template>
  </div>
  <app-footer></app-footer>
</ion-content>